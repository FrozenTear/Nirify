// Horizontal category navigation for Control Deck design
//
// Replaces traditional sidebar with a modern horizontal pill-based navigation.

import { Theme } from "../styles.slint";

// Category group data
export struct CategoryGroup {
    name: string,
    accent: color,
}

// Individual category pill button with smooth transitions
component CategoryPill inherits Rectangle {
    in property <string> label;
    in property <color> accent-color: Theme.accent;
    in property <bool> selected: false;

    callback clicked();

    accessible-role: button;
    accessible-label: label;
    accessible-checkable: true;
    accessible-checked: selected;

    height: 36px;
    min-width: 80px;
    background: selected ? accent-color.with-alpha(0.2) :
                touch.has-hover ? Theme.surface-elevated : transparent;
    border-radius: 18px;
    border-width: selected ? 1px : 0px;
    border-color: accent-color.with-alpha(0.5);

    // Smooth transitions
    animate background { duration: 200ms; easing: ease-out; }
    animate border-width { duration: 150ms; easing: ease-out; }
    animate border-color { duration: 200ms; easing: ease-out; }

    HorizontalLayout {
        padding-left: Theme.spacing-md;
        padding-right: Theme.spacing-md;
        alignment: center;

        Text {
            text: label;
            color: selected ? accent-color : touch.has-hover ? Theme.text-primary : Theme.text-secondary;
            font-size: Theme.font-size-sm;
            font-weight: selected ? 600 : 400;
            horizontal-alignment: center;
            vertical-alignment: center;

            animate color { duration: 150ms; easing: ease-out; }
        }
    }

    touch := TouchArea {
        mouse-cursor: pointer;
        clicked => {
            root.clicked();
        }
    }
}

// Sub-navigation item with animated underline indicator
component SubNavItem inherits Rectangle {
    in property <string> label;
    in property <color> accent-color: Theme.accent;
    in property <bool> selected: false;

    callback clicked();

    accessible-role: button;
    accessible-label: label;
    accessible-checkable: true;
    accessible-checked: selected;

    height: 32px;
    min-width: 60px;
    background: transparent;

    // Animated bottom accent line
    Rectangle {
        x: selected ? Theme.spacing-xs : (parent.width / 2) - (self.width / 2);
        y: parent.height - 2px;
        width: selected ? parent.width - Theme.spacing-sm : 0px;
        height: 2px;
        background: accent-color;
        border-radius: 1px;

        // Smooth width and position animation
        animate width { duration: 200ms; easing: cubic-bezier(0.4, 0, 0.2, 1); }
        animate x { duration: 200ms; easing: cubic-bezier(0.4, 0, 0.2, 1); }
        animate background { duration: 150ms; easing: ease-out; }
    }

    HorizontalLayout {
        padding-left: Theme.spacing-sm;
        padding-right: Theme.spacing-sm;
        alignment: center;

        Text {
            text: label;
            color: selected ? accent-color : touch.has-hover ? Theme.text-primary : Theme.text-muted;
            font-size: Theme.font-size-sm;
            font-weight: selected ? 500 : 400;
            horizontal-alignment: center;
            vertical-alignment: center;

            animate color { duration: 150ms; easing: ease-out; }
        }
    }

    touch := TouchArea {
        mouse-cursor: pointer;
        clicked => {
            root.clicked();
        }
    }
}

// Main horizontal category navigation bar with branding
export component CategoryNav inherits Rectangle {
    in-out property <int> selected-group: 0;  // 0=Appearance, 1=Input, 2=Visuals, 3=Layout, 4=Rules, 5=System
    in-out property <int> selected-page: 0;   // Page index within the group

    // Debug options visibility (hidden by default)
    in-out property <bool> show-debug-options: false;

    callback group-changed(int);
    callback page-changed(int);

    // Group definitions
    property <[string]> group-names: ["Appearance", "Input", "Visuals", "Layout", "Rules", "System"];

    // Page names per group
    property <[string]> appearance-pages: ["Windows", "Gaps", "Corners"];
    property <[string]> input-pages: ["Keyboard", "Mouse", "Touchpad", "Trackpoint", "Trackball", "Tablet", "Touch", "Displays"];
    property <[string]> visuals-pages: ["Animations", "Cursor", "Overview", "Recent Windows"];
    property <[string]> layout-pages: ["Behavior", "Extras", "Workspaces"];
    property <[string]> rules-pages: ["Window Rules", "Layer Rules", "Gestures"];
    property <[string]> system-pages: ["Keybindings", "Startup", "Environment", "Switch Events", "Miscellaneous", "Debug"];

    // Current accent based on selected group
    property <color> current-accent:
        selected-group == 0 ? Theme.accent-visual :
        selected-group == 1 ? Theme.accent-input :
        selected-group == 2 ? Theme.accent-visual :
        selected-group == 3 ? Theme.accent-layout :
        selected-group == 4 ? Theme.accent-rules :
        Theme.accent-system;

    height: 110px;
    background: Theme.sidebar-background;

    // Subtle gradient overlay at bottom
    Rectangle {
        y: parent.height - 1px;
        width: parent.width;
        height: 1px;
        background: @linear-gradient(90deg, transparent 0%, current-accent.with-alpha(0.3) 50%, transparent 100%);
    }

    VerticalLayout {
        padding: Theme.spacing-md;
        padding-top: Theme.spacing-sm;
        spacing: Theme.spacing-sm;

        // App branding header
        HorizontalLayout {
            alignment: center;
            height: 24px;

            Text {
                text: "niri settings";
                color: Theme.text-muted;
                font-size: 11px;
                font-weight: 500;
                letter-spacing: 2px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }

        // Main category row
        HorizontalLayout {
            alignment: center;
            spacing: Theme.spacing-xs;

            CategoryPill {
                label: "Appearance";
                accent-color: Theme.accent-visual;
                selected: selected-group == 0;
                clicked => {
                    selected-group = 0;
                    selected-page = 0;
                    root.group-changed(0);
                }
            }

            CategoryPill {
                label: "Input";
                accent-color: Theme.accent-input;
                selected: selected-group == 1;
                clicked => {
                    selected-group = 1;
                    selected-page = 0;
                    root.group-changed(1);
                }
            }

            CategoryPill {
                label: "Visuals";
                accent-color: Theme.accent-visual;
                selected: selected-group == 2;
                clicked => {
                    selected-group = 2;
                    selected-page = 0;
                    root.group-changed(2);
                }
            }

            CategoryPill {
                label: "Layout";
                accent-color: Theme.accent-layout;
                selected: selected-group == 3;
                clicked => {
                    selected-group = 3;
                    selected-page = 0;
                    root.group-changed(3);
                }
            }

            CategoryPill {
                label: "Rules";
                accent-color: Theme.accent-rules;
                selected: selected-group == 4;
                clicked => {
                    selected-group = 4;
                    selected-page = 0;
                    root.group-changed(4);
                }
            }

            CategoryPill {
                label: "System";
                accent-color: Theme.accent-system;
                selected: selected-group == 5;
                clicked => {
                    selected-group = 5;
                    selected-page = 0;
                    root.group-changed(5);
                }
            }
        }

        // Sub-navigation row (changes based on selected group)
        HorizontalLayout {
            alignment: center;
            spacing: Theme.spacing-xs;

            // Appearance sub-nav
            if selected-group == 0: SubNavItem {
                label: "Windows";
                accent-color: Theme.accent-visual;
                selected: selected-page == 0;
                clicked => { selected-page = 0; root.page-changed(0); }
            }
            if selected-group == 0: SubNavItem {
                label: "Gaps";
                accent-color: Theme.accent-visual;
                selected: selected-page == 1;
                clicked => { selected-page = 1; root.page-changed(1); }
            }
            if selected-group == 0: SubNavItem {
                label: "Corners";
                accent-color: Theme.accent-visual;
                selected: selected-page == 2;
                clicked => { selected-page = 2; root.page-changed(2); }
            }

            // Input sub-nav
            if selected-group == 1: SubNavItem {
                label: "Keyboard";
                accent-color: Theme.accent-input;
                selected: selected-page == 0;
                clicked => { selected-page = 0; root.page-changed(0); }
            }
            if selected-group == 1: SubNavItem {
                label: "Mouse";
                accent-color: Theme.accent-input;
                selected: selected-page == 1;
                clicked => { selected-page = 1; root.page-changed(1); }
            }
            if selected-group == 1: SubNavItem {
                label: "Touchpad";
                accent-color: Theme.accent-input;
                selected: selected-page == 2;
                clicked => { selected-page = 2; root.page-changed(2); }
            }
            if selected-group == 1: SubNavItem {
                label: "Trackpoint";
                accent-color: Theme.accent-input;
                selected: selected-page == 3;
                clicked => { selected-page = 3; root.page-changed(3); }
            }
            if selected-group == 1: SubNavItem {
                label: "Trackball";
                accent-color: Theme.accent-input;
                selected: selected-page == 4;
                clicked => { selected-page = 4; root.page-changed(4); }
            }
            if selected-group == 1: SubNavItem {
                label: "Tablet";
                accent-color: Theme.accent-input;
                selected: selected-page == 5;
                clicked => { selected-page = 5; root.page-changed(5); }
            }
            if selected-group == 1: SubNavItem {
                label: "Touch";
                accent-color: Theme.accent-input;
                selected: selected-page == 6;
                clicked => { selected-page = 6; root.page-changed(6); }
            }
            if selected-group == 1: SubNavItem {
                label: "Displays";
                accent-color: Theme.accent-input;
                selected: selected-page == 7;
                clicked => { selected-page = 7; root.page-changed(7); }
            }

            // Visuals sub-nav
            if selected-group == 2: SubNavItem {
                label: "Animations";
                accent-color: Theme.accent-visual;
                selected: selected-page == 0;
                clicked => { selected-page = 0; root.page-changed(0); }
            }
            if selected-group == 2: SubNavItem {
                label: "Cursor";
                accent-color: Theme.accent-visual;
                selected: selected-page == 1;
                clicked => { selected-page = 1; root.page-changed(1); }
            }
            if selected-group == 2: SubNavItem {
                label: "Overview";
                accent-color: Theme.accent-visual;
                selected: selected-page == 2;
                clicked => { selected-page = 2; root.page-changed(2); }
            }
            if selected-group == 2: SubNavItem {
                label: "Recent Windows";
                accent-color: Theme.accent-visual;
                selected: selected-page == 3;
                clicked => { selected-page = 3; root.page-changed(3); }
            }

            // Layout sub-nav
            if selected-group == 3: SubNavItem {
                label: "Behavior";
                accent-color: Theme.accent-layout;
                selected: selected-page == 0;
                clicked => { selected-page = 0; root.page-changed(0); }
            }
            if selected-group == 3: SubNavItem {
                label: "Extras";
                accent-color: Theme.accent-layout;
                selected: selected-page == 1;
                clicked => { selected-page = 1; root.page-changed(1); }
            }
            if selected-group == 3: SubNavItem {
                label: "Workspaces";
                accent-color: Theme.accent-layout;
                selected: selected-page == 2;
                clicked => { selected-page = 2; root.page-changed(2); }
            }

            // Rules sub-nav
            if selected-group == 4: SubNavItem {
                label: "Window Rules";
                accent-color: Theme.accent-rules;
                selected: selected-page == 0;
                clicked => { selected-page = 0; root.page-changed(0); }
            }
            if selected-group == 4: SubNavItem {
                label: "Layer Rules";
                accent-color: Theme.accent-rules;
                selected: selected-page == 1;
                clicked => { selected-page = 1; root.page-changed(1); }
            }
            if selected-group == 4: SubNavItem {
                label: "Gestures";
                accent-color: Theme.accent-rules;
                selected: selected-page == 2;
                clicked => { selected-page = 2; root.page-changed(2); }
            }

            // System sub-nav
            if selected-group == 5: SubNavItem {
                label: "Keybindings";
                accent-color: Theme.accent-system;
                selected: selected-page == 0;
                clicked => { selected-page = 0; root.page-changed(0); }
            }
            if selected-group == 5: SubNavItem {
                label: "Startup";
                accent-color: Theme.accent-system;
                selected: selected-page == 1;
                clicked => { selected-page = 1; root.page-changed(1); }
            }
            if selected-group == 5: SubNavItem {
                label: "Environment";
                accent-color: Theme.accent-system;
                selected: selected-page == 2;
                clicked => { selected-page = 2; root.page-changed(2); }
            }
            if selected-group == 5: SubNavItem {
                label: "Switch Events";
                accent-color: Theme.accent-system;
                selected: selected-page == 3;
                clicked => { selected-page = 3; root.page-changed(3); }
            }
            if selected-group == 5: SubNavItem {
                label: "Misc";
                accent-color: Theme.accent-system;
                selected: selected-page == 4;
                clicked => { selected-page = 4; root.page-changed(4); }
            }
            if selected-group == 5 && show-debug-options: SubNavItem {
                label: "Debug";
                accent-color: Theme.accent-system;
                selected: selected-page == 5;
                clicked => { selected-page = 5; root.page-changed(5); }
            }
        }
    }
}
