// Search results dropdown panel
//
// Displays search results in a floating panel below the search bar.
// Each result shows label + description with category accent line.

import { Theme, SearchResultItem } from "../styles.slint";

export component SearchResultsPanel inherits Rectangle {
    in property <[SearchResultItem]> results: [];
    in property <color> accent-color: Theme.accent;

    callback result-selected(int);

    // Accessibility
    accessible-role: list;
    accessible-label: "Search results";

    property <int> hovered-index: -1;

    background: Theme.card-background;
    border-radius: Theme.radius-lg;
    border-width: 1px;
    border-color: Theme.border;
    max-height: 350px;
    min-height: results.length > 0 ? 80px : 48px;

    // Left accent line
    Rectangle {
        x: 0;
        y: 0;
        width: Theme.accent-line-width;
        height: parent.height;
        background: accent-color;
        border-top-left-radius: Theme.radius-lg;
        border-bottom-left-radius: Theme.radius-lg;
    }

    VerticalLayout {
        padding: Theme.spacing-sm;
        padding-left: Theme.spacing-sm + Theme.accent-line-width;
        spacing: Theme.spacing-xs;

        // Result count header
        Rectangle {
            height: 28px;
            background: transparent;

            HorizontalLayout {
                padding-left: Theme.spacing-sm;
                alignment: start;

                Text {
                    text: results.length == 1 ? "1 result" : results.length + " results";
                    color: Theme.text-muted;
                    font-size: Theme.font-size-sm;
                    font-weight: 500;
                    vertical-alignment: center;
                }
            }
        }

        // Results list
        if results.length > 0: VerticalLayout {
            for item[idx] in results: touch := TouchArea {
                height: 52px;
                mouse-cursor: pointer;

                clicked => {
                    root.result-selected(item.category);
                }

                moved => {
                    hovered-index = idx;
                }

                Rectangle {
                    background: idx == hovered-index ? Theme.surface-elevated : transparent;
                    border-radius: Theme.radius-md;

                    animate background { duration: Theme.duration-fast; easing: ease-out; }

                    HorizontalLayout {
                        padding: Theme.spacing-sm;
                        padding-left: Theme.spacing-md;
                        spacing: Theme.spacing-sm;

                        // Small accent indicator
                        Rectangle {
                            width: 4px;
                            height: 32px;
                            background: accent-color.with-alpha(idx == hovered-index ? 1.0 : 0.5);
                            border-radius: 2px;
                            y: (parent.height - self.height) / 2;

                            animate background { duration: Theme.duration-fast; }
                        }

                        // Text content
                        VerticalLayout {
                            horizontal-stretch: 1;
                            spacing: 2px;
                            alignment: center;

                            Text {
                                text: item.label;
                                color: idx == hovered-index ? Theme.text-primary : Theme.text-secondary;
                                font-size: Theme.font-size-md;
                                font-weight: 500;
                                overflow: elide;

                                animate color { duration: Theme.duration-fast; }
                            }

                            Text {
                                text: item.description;
                                color: Theme.text-muted;
                                font-size: Theme.font-size-sm;
                                overflow: elide;
                            }
                        }

                        // Score indicator (subtle)
                        Rectangle {
                            width: 32px;
                            height: parent.height;

                            Text {
                                text: item.score + "%";
                                color: Theme.text-muted;
                                font-size: Theme.font-size-xs;
                                horizontal-alignment: right;
                                vertical-alignment: center;
                            }
                        }
                    }
                }
            }
        }

        // Empty state
        if results.length == 0: Rectangle {
            height: 40px;
            background: transparent;

            Text {
                text: "No results found";
                color: Theme.text-muted;
                font-size: Theme.font-size-md;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
    }
}
