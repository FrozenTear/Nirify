import { Theme } from "../styles.slint";
import { ScrollView, Button, ComboBox } from "std-widgets.slint";
import { SettingsSection } from "../widgets/section.slint";

// Read-only config file viewer
export component ConfigEditorPage inherits Rectangle {
    accessible-role: none;
    accessible-label: "Configuration editor";

    in-out property <string> file-content: "";
    in-out property <int> selected-file-index: 0;
    in-out property <string> current-file-name: "main.kdl";

    callback load-file-requested(int);
    callback refresh-requested();

    background: transparent;

    ScrollView {
        VerticalLayout {
            alignment: start;
            spacing: Theme.spacing-lg;
            padding-right: Theme.spacing-md;

            // Info banner
            Rectangle {
                background: Theme.info.with-alpha(0.15);
                border-radius: Theme.radius-md;
                border-width: 1px;
                border-color: Theme.info.with-alpha(0.3);
                height: 48px;

                HorizontalLayout {
                    padding: Theme.spacing-md;
                    spacing: Theme.spacing-sm;

                    Rectangle {
                        width: 8px;
                        height: 8px;
                        border-radius: 4px;
                        background: Theme.info;
                        y: (parent.height - self.height) / 2;
                    }

                    Text {
                        text: "View-only: These files are generated from your settings.";
                        color: Theme.info;
                        font-size: Theme.font-size-md;
                        vertical-alignment: center;
                    }
                }
            }

            // File selector
            SettingsSection {
                title: "SELECT FILE";

                HorizontalLayout {
                    spacing: Theme.spacing-md;

                    file-combo := ComboBox {
                        model: [
                            "main.kdl",
                            "appearance.kdl",
                            "behavior.kdl",
                            "animations.kdl",
                            "cursor.kdl",
                            "overview.kdl",
                            "outputs.kdl",
                            "workspaces.kdl",
                            "keybindings.kdl",
                            "input/keyboard.kdl",
                            "input/mouse.kdl",
                            "input/touchpad.kdl",
                            "input/trackpoint.kdl",
                            "input/trackball.kdl",
                            "input/tablet.kdl",
                            "input/touch.kdl",
                            "advanced/layout-extras.kdl",
                            "advanced/gestures.kdl",
                            "advanced/misc.kdl",
                            "advanced/startup.kdl",
                            "advanced/environment.kdl",
                            "advanced/debug.kdl",
                            "advanced/switch-events.kdl",
                            "advanced/window-rules.kdl",
                            "advanced/layer-rules.kdl",
                            "advanced/recent-windows.kdl"
                        ];
                        current-index <=> root.selected-file-index;
                        selected(text) => {
                            root.current-file-name = text;
                            root.load-file-requested(self.current-index);
                        }
                    }

                    Button {
                        text: "Refresh";
                        clicked => {
                            root.refresh-requested();
                        }
                    }
                }
            }

            // File content viewer
            SettingsSection {
                title: "FILE: " + root.current-file-name;

                Rectangle {
                    background: Theme.card-background;
                    border-radius: Theme.radius-md;
                    border-width: 1px;
                    border-color: Theme.border;
                    min-height: 400px;

                    ScrollView {
                        VerticalLayout {
                            padding: Theme.spacing-md;

                            Text {
                                text: root.file-content != "" ? root.file-content : "Select a file to view its contents...";
                                color: root.file-content != "" ? Theme.text-primary : Theme.text-muted;
                                font-size: Theme.font-size-sm;
                                font-family: "monospace";
                                wrap: word-wrap;
                            }
                        }
                    }
                }
            }

            // Spacer at bottom
            Rectangle { height: Theme.spacing-lg; }
        }
    }
}
