import { Theme } from "../styles.slint";
import { ScrollView } from "std-widgets.slint";
import { SettingsSection, SettingRow } from "../widgets/section.slint";
import { ToggleRow } from "../widgets/toggle_row.slint";
import { SliderRow } from "../widgets/slider_row.slint";
import { ColorPicker, ColorSwatches } from "../widgets/color_picker.slint";

// Appearance settings page for niri
// Sub-pages: 0=Windows (focus ring + border), 1=Gaps, 2=Corners
export component AppearancePage inherits Rectangle {
    accessible-role: none;
    accessible-label: "Appearance settings";

    // Sub-page selection (from CategoryNav)
    in property <int> sub-page: 0;
    // Window border settings
    in-out property <bool> focus-ring-enabled: true;
    in-out property <float> focus-ring-width: 4;
    in-out property <color> focus-ring-active-color: #7fc8ff;
    in-out property <color> focus-ring-inactive-color: #505050;
    in-out property <color> focus-ring-urgent-color: #ff5555;
    in-out property <string> focus-ring-active-hex: "#7fc8ff";
    in-out property <string> focus-ring-inactive-hex: "#505050";
    in-out property <string> focus-ring-urgent-hex: "#ff5555";

    // Border settings
    in-out property <bool> border-enabled: false;
    in-out property <float> border-thickness: 1;
    in-out property <color> border-active-color: #ffffff;
    in-out property <color> border-inactive-color: #808080;
    in-out property <color> border-urgent-color: #ff5555;
    in-out property <string> border-active-hex: "#ffffff";
    in-out property <string> border-inactive-hex: "#808080";
    in-out property <string> border-urgent-hex: "#ff5555";

    // Window gaps
    in-out property <float> gaps-inner: 16;
    in-out property <float> gaps-outer: 8;

    // Corner radius
    in-out property <float> corner-radius: 12;

    // Background color
    in-out property <color> background-color: #1e1e2e;
    in-out property <string> background-color-hex: "#1e1e2e";

    // Callbacks for settings changes
    callback focus-ring-toggled(bool);
    callback focus-ring-width-changed(float);
    callback focus-ring-active-color-changed(color);
    callback focus-ring-inactive-color-changed(color);
    callback focus-ring-urgent-color-changed(color);
    callback border-toggled(bool);
    callback border-thickness-changed(float);
    callback border-active-color-changed(color);
    callback border-inactive-color-changed(color);
    callback border-urgent-color-changed(color);
    callback gaps-inner-changed(float);
    callback gaps-outer-changed(float);
    callback corner-radius-changed(float);
    callback background-color-changed(color);

    background: transparent;

    ScrollView {
        VerticalLayout {
            alignment: start;
            spacing: Theme.spacing-lg;
            padding-right: Theme.spacing-md;

            // ═══════════════════════════════════════════════════════════════
            // WINDOWS SUB-PAGE (sub-page == 0)
            // ═══════════════════════════════════════════════════════════════

            // Focus Ring Section
            if sub-page == 0: SettingsSection {
                title: "FOCUS RING";
                accent-color: Theme.accent-visual;

                VerticalLayout {
                    spacing: Theme.spacing-sm;

                    ToggleRow {
                        label: "Enable focus ring";
                        description: "Show a colored ring around the focused window";
                        checked: root.focus-ring-enabled;
                        toggled(val) => {
                            root.focus-ring-enabled = val;
                            root.focus-ring-toggled(val);
                        }
                    }

                    if root.focus-ring-enabled: SliderRow {
                        label: "Ring width";
                        description: "Thickness of the focus ring in pixels";
                        suffix: "px";
                        minimum: 1;
                        maximum: 16;
                        value: root.focus-ring-width;
                        changed(val) => {
                            root.focus-ring-width = val;
                            root.focus-ring-width-changed(val);
                        }
                    }

                    if root.focus-ring-enabled: ColorPicker {
                        label: "Active color";
                        description: "Color when window is focused";
                        selected-color: root.focus-ring-active-color;
                        hex-value: root.focus-ring-active-hex;
                        changed(col) => {
                            root.focus-ring-active-color = col;
                            root.focus-ring-active-color-changed(col);
                        }
                    }

                    if root.focus-ring-enabled: ColorPicker {
                        label: "Inactive color";
                        description: "Color when window is not focused";
                        selected-color: root.focus-ring-inactive-color;
                        hex-value: root.focus-ring-inactive-hex;
                        changed(col) => {
                            root.focus-ring-inactive-color = col;
                            root.focus-ring-inactive-color-changed(col);
                        }
                    }

                    if root.focus-ring-enabled: ColorPicker {
                        label: "Urgent color";
                        description: "Color when window needs attention";
                        selected-color: root.focus-ring-urgent-color;
                        hex-value: root.focus-ring-urgent-hex;
                        changed(col) => {
                            root.focus-ring-urgent-color = col;
                            root.focus-ring-urgent-color-changed(col);
                        }
                    }
                }
            }

            // Border Section
            if sub-page == 0: SettingsSection {
                title: "WINDOW BORDER";
                accent-color: Theme.accent-visual;

                VerticalLayout {
                    spacing: Theme.spacing-sm;

                    ToggleRow {
                        label: "Enable window border";
                        description: "Show a border around windows (inside the focus ring)";
                        checked: root.border-enabled;
                        toggled(val) => {
                            root.border-enabled = val;
                            root.border-toggled(val);
                        }
                    }

                    if root.border-enabled: SliderRow {
                        label: "Border width";
                        description: "Thickness of the window border in pixels";
                        suffix: "px";
                        minimum: 1;
                        maximum: 8;
                        value: root.border-thickness;
                        changed(val) => {
                            root.border-thickness = val;
                            root.border-thickness-changed(val);
                        }
                    }

                    if root.border-enabled: ColorPicker {
                        label: "Active color";
                        description: "Border color when window is focused";
                        selected-color: root.border-active-color;
                        hex-value: root.border-active-hex;
                        changed(col) => {
                            root.border-active-color = col;
                            root.border-active-color-changed(col);
                        }
                    }

                    if root.border-enabled: ColorPicker {
                        label: "Inactive color";
                        description: "Border color when window is not focused";
                        selected-color: root.border-inactive-color;
                        hex-value: root.border-inactive-hex;
                        changed(col) => {
                            root.border-inactive-color = col;
                            root.border-inactive-color-changed(col);
                        }
                    }

                    if root.border-enabled: ColorPicker {
                        label: "Urgent color";
                        description: "Border color when window needs attention";
                        selected-color: root.border-urgent-color;
                        hex-value: root.border-urgent-hex;
                        changed(col) => {
                            root.border-urgent-color = col;
                            root.border-urgent-color-changed(col);
                        }
                    }
                }
            }

            // Background Color Section
            if sub-page == 0: SettingsSection {
                title: "BACKGROUND";
                accent-color: Theme.accent-visual;

                ColorPicker {
                    label: "Window background";
                    description: "Default background color for windows";
                    selected-color: root.background-color;
                    hex-value: root.background-color-hex;
                    changed(col) => {
                        root.background-color = col;
                        root.background-color-changed(col);
                    }
                }
            }

            // ═══════════════════════════════════════════════════════════════
            // GAPS SUB-PAGE (sub-page == 1)
            // ═══════════════════════════════════════════════════════════════

            // Gaps Section
            if sub-page == 1: SettingsSection {
                title: "WINDOW GAPS";
                accent-color: Theme.accent-visual;

                VerticalLayout {
                    spacing: Theme.spacing-sm;

                    SliderRow {
                        label: "Inner gaps";
                        description: "Space between windows";
                        suffix: "px";
                        minimum: 0;
                        maximum: 64;
                        value: root.gaps-inner;
                        changed(val) => {
                            root.gaps-inner = val;
                            root.gaps-inner-changed(val);
                        }
                    }

                    SliderRow {
                        label: "Outer gaps";
                        description: "Space between windows and screen edges";
                        suffix: "px";
                        minimum: 0;
                        maximum: 64;
                        value: root.gaps-outer;
                        changed(val) => {
                            root.gaps-outer = val;
                            root.gaps-outer-changed(val);
                        }
                    }
                }
            }

            // ═══════════════════════════════════════════════════════════════
            // CORNERS SUB-PAGE (sub-page == 2)
            // ═══════════════════════════════════════════════════════════════

            // Corner Radius Section
            if sub-page == 2: SettingsSection {
                title: "CORNERS";
                accent-color: Theme.accent-visual;

                SliderRow {
                    label: "Corner radius";
                    description: "Roundness of window corners";
                    suffix: "px";
                    minimum: 0;
                    maximum: 32;
                    value: root.corner-radius;
                    changed(val) => {
                        root.corner-radius = val;
                        root.corner-radius-changed(val);
                    }
                }
            }

            // Spacer at bottom
            Rectangle {
                height: Theme.spacing-lg;
            }
        }
    }
}
