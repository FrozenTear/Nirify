// Expandable/collapsible section widget
// Used for progressive disclosure of advanced options

import { Theme } from "../styles.slint";

// Standalone expandable section with card background
export component ExpandableSection inherits Rectangle {
    in property <string> title;
    in property <string> description: "";
    in-out property <bool> expanded: false;

    callback toggled(bool);

    accessible-role: button;
    accessible-label: expanded ? "Collapse " + title : "Expand " + title;
    accessible-description: description;

    background: Theme.card-background;
    border-radius: Theme.radius-md;

    VerticalLayout {
        padding: Theme.spacing-md;
        spacing: Theme.spacing-sm;

        // Header (clickable)
        header-area := Rectangle {
            height: Theme.section-header-height;
            background: touch.has-hover ? Theme.surface-elevated : transparent;
            border-radius: Theme.radius-sm;
            border-width: header-focus.has-focus ? 2px : 0px;
            border-color: Theme.border-focus;

            header-focus := FocusScope {
                key-pressed(event) => {
                    if (event.text == " " || event.text == "\n") {
                        root.expanded = !root.expanded;
                        root.toggled(root.expanded);
                        accept
                    }
                    reject
                }
            }

            touch := TouchArea {
                clicked => {
                    header-focus.focus();
                    root.expanded = !root.expanded;
                    root.toggled(root.expanded);
                }
            }

            HorizontalLayout {
                padding-left: Theme.spacing-sm;
                padding-right: Theme.spacing-sm;
                spacing: Theme.spacing-sm;

                // Expand/collapse icon
                Text {
                    text: root.expanded ? "▼" : "▶";
                    color: Theme.text-secondary;
                    font-size: Theme.font-size-md;
                    vertical-alignment: center;
                    width: Theme.icon-size-sm;
                }

                // Title and description
                VerticalLayout {
                    horizontal-stretch: 1;
                    alignment: center;
                    spacing: 2px;

                    Text {
                        text: root.title;
                        color: Theme.text-primary;
                        font-size: Theme.font-size-md;
                        font-weight: 600;
                    }

                    if root.description != "": Text {
                        text: root.description;
                        color: Theme.text-muted;
                        font-size: Theme.font-size-sm;
                        wrap: word-wrap;
                    }
                }
            }

            animate background {
                duration: Theme.duration-fast;
                easing: ease-in-out;
            }
            animate border-width {
                duration: Theme.duration-fast;
                easing: ease-in-out;
            }
        }

        // Content area (visibility controlled by expanded state)
        VerticalLayout {
            visible: root.expanded;
            spacing: Theme.spacing-sm;
            padding-top: Theme.spacing-xs;

            @children
        }
    }
}

// Lightweight expandable group for use inside SettingsSection
export component ExpandableGroup inherits Rectangle {
    in property <string> title;
    in-out property <bool> expanded: false;

    callback toggled(bool);

    accessible-role: button;
    accessible-label: expanded ? "Collapse " + title : "Expand " + title;

    background: transparent;
    min-height: Theme.control-height;

    VerticalLayout {
        spacing: Theme.spacing-sm;

        // Header
        Rectangle {
            height: Theme.control-height;
            background: touch.has-hover ? Theme.surface-elevated : transparent;
            border-radius: Theme.radius-sm;
            border-width: group-focus.has-focus ? 2px : 0px;
            border-color: Theme.border-focus;

            group-focus := FocusScope {
                key-pressed(event) => {
                    if (event.text == " " || event.text == "\n") {
                        root.expanded = !root.expanded;
                        root.toggled(root.expanded);
                        accept
                    }
                    reject
                }
            }

            touch := TouchArea {
                clicked => {
                    group-focus.focus();
                    root.expanded = !root.expanded;
                    root.toggled(root.expanded);
                }
            }

            HorizontalLayout {
                padding-left: Theme.spacing-sm;
                spacing: Theme.spacing-sm;

                Text {
                    text: root.expanded ? "▼" : "▶";
                    color: Theme.text-secondary;
                    font-size: Theme.font-size-sm;
                    vertical-alignment: center;
                }

                Text {
                    text: root.title;
                    color: Theme.text-primary;
                    font-size: Theme.font-size-md;
                    vertical-alignment: center;
                }
            }

            animate background {
                duration: Theme.duration-fast;
                easing: ease-in-out;
            }
            animate border-width {
                duration: Theme.duration-fast;
                easing: ease-in-out;
            }
        }

        // Content (indented, visibility controlled by expanded state)
        Rectangle {
            visible: root.expanded;
            background: transparent;

            VerticalLayout {
                padding-left: Theme.spacing-lg;
                spacing: Theme.spacing-sm;

                @children
            }
        }
    }
}
