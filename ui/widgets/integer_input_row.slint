// Integer input row widget
// Numeric input with label, description, validation, and optional suffix

import { Theme } from "../styles.slint";
import { LineEdit } from "std-widgets.slint";
import { BaseSettingRow } from "base_setting_row.slint";

export component IntegerInputRow inherits BaseSettingRow {
    in property <string> suffix: "";
    in property <string> placeholder: "";
    in property <int> minimum: 0;
    in property <int> maximum: 999999;
    in-out property <int> value: 0;

    callback changed(int);

    // Control section (fixed width, aligned with other controls)
    Rectangle {
        width: Theme.control-column-width;
        background: transparent;

        VerticalLayout {
            alignment: center;

            HorizontalLayout {
                alignment: end;
                spacing: Theme.spacing-xs;

                input := LineEdit {
                    width: Theme.input-width;
                    text: "\{root.value}";
                    placeholder-text: root.placeholder;
                    font-size: Theme.font-size-sm;
                    horizontal-alignment: right;
                    input-type: number;

                    accessible-label: root.label;
                    accessible-description: root.description;

                    edited(new-text) => {
                        // Real-time validation: parse and clamp value as user types
                        // This provides immediate feedback for valid input
                        if (new-text != "") {
                            root.value = clamp(round(new-text.to-float()), root.minimum, root.maximum);
                        }
                    }

                    accepted => {
                        // Final validation on Enter - notify callback with clamped value
                        root.changed(clamp(round(self.text.to-float()), root.minimum, root.maximum));
                    }
                }

                if root.suffix != "": Text {
                    text: root.suffix;
                    color: Theme.text-muted;
                    font-size: Theme.font-size-sm;
                    vertical-alignment: center;
                }
            }
        }
    }
}
